import { interpolate } from './coord.js';
const toDeg = (rad) => rad*(180/Math.PI);
const toRad = (deg) => deg*(Math.PI/180);
const shaDecToLatLon = ([ sha, dec ]) => [
	toRad(dec),
	toRad(sha < 180 ? -sha : 360 - sha),
];
const latLonToShaDec = ([ lat, lon ]) => [
	(360 - toDeg(lon))%360,
	toDeg(lat),
];
const Almanac = {
	timeList: [1420070400,1451606400,1483228800,1514764800,1546300800,1577836800,1609459200,1640995200,1672531200,1704067200,1735689600],
	stars: [{
		name: "Alpheratz",
		regex: /^alpheratz$/i,
		sha: [357.70576,357.69423,357.68277,357.67137,357.65972,357.64757,357.63493,357.62193,357.60836,357.59428,357.5799],
		dec: [29.17362,29.1785,29.18341,29.18838,29.19353,29.19893,29.20452,29.21027,29.21623,29.22233,29.22848],
	}, {
		name: "Ankaa",
		regex: /^ankaa$/i,
		sha: [353.24549,353.23464,353.2235,353.21202,353.19992,353.18721,353.17406,353.16063,353.1468,353.13287,353.11909],
		dec: [-42.2243,-42.21951,-42.21466,-42.20974,-42.20462,-42.19925,-42.19367,-42.18795,-42.18203,-42.17599,-42.16992],
	}, {
		name: "Schedar",
		regex: /^sc?hed[ai]r$/i,
		sha: [349.65278,349.63998,349.62748,349.61528,349.60304,349.59033,349.57707,349.56336,349.54894,349.53372,349.51791],
		dec: [56.61942,56.62425,56.62915,56.63414,56.63936,56.64482,56.65048,56.65628,56.66228,56.66838,56.67448],
	}, {
		name: "Diphda",
		regex: /^diphda$/i,
		sha: [348.91422,348.90313,348.8919,348.88049,348.86861,348.85617,348.84326,348.83004,348.81636,348.80241,348.78844],
		dec: [-17.90449,-17.89965,-17.89474,-17.88974,-17.88451,-17.87903,-17.87336,-17.86754,-17.86153,-17.85542,-17.84931],
	}, {
		name: "Achernar",
		regex: /^achernar$/i,
		sha: [335.43519,335.42706,335.41853,335.40954,335.39989,335.3897,335.37919,335.3685,335.35758,335.34677,335.33629],
		dec: [-57.16156,-57.15711,-57.15253,-57.1478,-57.14281,-57.13755,-57.13211,-57.12656,-57.12085,-57.11511,-57.10944],
	}, {
		name: "Hamal",
		regex: /^hamal$/i,
		sha: [327.99208,327.97951,327.96697,327.95443,327.94154,327.9281,327.91412,327.89975,327.88479,327.86933,327.85362],
		dec: [23.53175,23.53586,23.54012,23.54457,23.5493,23.55429,23.55945,23.5647,23.57009,23.57548,23.58074],
	}, {
		name: "Polaris",
		regex: /^polaris$/i,
		sha: [317.24844,316.94635,316.65494,316.37501,316.09767,315.80826,315.50088,315.17695,314.82804,314.44681,314.03752],
		dec: [89.32642,89.32999,89.33373,89.33768,89.34192,89.34638,89.35097,89.35562,89.36032,89.36493,89.36934],
	}, {
		name: "Acamar",
		regex: /^acamar$/i,
		sha: [315.29319,315.28483,315.27628,315.26749,315.25824,315.24854,315.23848,315.22819,315.2176,315.20689,315.19627],
		dec: [-40.24664,-40.24317,-40.2395,-40.23561,-40.23141,-40.22698,-40.2224,-40.21775,-40.21302,-40.20836,-40.20387],
	}, {
		name: "Menkar",
		regex: /^menkar$/i,
		sha: [314.23229,314.22068,314.20903,314.19729,314.18516,314.17248,314.1593,314.14578,314.13174,314.11731,314.10273],
		dec: [4.14623,4.1496,4.15318,4.15698,4.16109,4.16544,4.16992,4.17447,4.17911,4.18366,4.18804],
	}, {
		name: "Mirfak",
		regex: /^mirfak$/i,
		sha: [308.64599,308.63002,308.61414,308.59833,308.58215,308.56529,308.54775,308.52969,308.51085,308.49131,308.47137],
		dec: [49.91164,49.91467,49.9179,49.92138,49.92518,49.92919,49.93333,49.93753,49.94178,49.94592,49.94986],
	}, {
		name: "Aldebaran",
		regex: /^aldebaran$/i,
		sha: [290.80259,290.78985,290.77706,290.7642,290.75092,290.73704,290.72263,290.70782,290.69244,290.67663,290.66065],
		dec: [16.53602,16.53767,16.53956,16.54171,16.54418,16.54683,16.54953,16.55225,16.55495,16.55746,16.55971],
	}, {
		name: "Rigel",
		regex: /^rigel$/i,
		sha: [281.18405,281.1734,281.16268,281.15187,281.14067,281.12897,281.11681,281.10433,281.09139,281.07811,281.06472],
		dec: [-8.18782,-8.18692,-8.18577,-8.18434,-8.18262,-8.18075,-8.17886,-8.17698,-8.17516,-8.17357,-8.17226],
	}, {
		name: "Capella",
		regex: /^capella$/i,
		sha: [280.54778,280.53137,280.51492,280.49839,280.48132,280.46349,280.44497,280.42595,280.40619,280.38584,280.36527],
		dec: [46.0092,46.00992,46.0109,46.01215,46.0137,46.01539,46.0171,46.01879,46.02043,46.02183,46.02295],
	}, {
		name: "Bellatrix",
		regex: /^bellatrix$/i,
		sha: [278.51456,278.50267,278.49072,278.47867,278.46621,278.45319,278.43966,278.42577,278.41136,278.39655,278.38162],
		dec: [6.35961,6.36028,6.3612,6.3624,6.36388,6.3655,6.36714,6.36876,6.3703,6.37162,6.37264],
	}, {
		name: "Elnath",
		regex: /^elnath$/i,
		sha: [278.18793,278.17391,278.15983,278.14566,278.13101,278.1157,278.0998,278.08347,278.06651,278.04909,278.03149],
		dec: [28.61624,28.61684,28.61769,28.61881,28.62022,28.62176,28.62332,28.62486,28.62633,28.62756,28.6285],
	}, {
		name: "Alnilam",
		regex: /^alnilam$/i,
		sha: [275.75494,275.74369,275.73239,275.72099,275.70919,275.69685,275.68404,275.67089,275.65724,275.64324,275.62911],
		dec: [-1.196,-1.19556,-1.19487,-1.19391,-1.19266,-1.19129,-1.18992,-1.18857,-1.1873,-1.18627,-1.18554],
	}, {
		name: "Betelgeuse",
		regex: /^betelgeuse$/i,
		sha: [271.0026,270.9906,270.97854,270.96638,270.9538,270.94064,270.92698,270.91296,270.89841,270.88347,270.8684],
		dec: [7.40608,7.40611,7.40639,7.40694,7.40777,7.4087,7.40962,7.41049,7.41128,7.4118,7.41202],
	}, {
		name: "Canopus",
		regex: /^canopus$/i,
		sha: [263.92782,263.92289,263.91797,263.91305,263.908,263.90272,263.89723,263.89159,263.88571,263.87965,263.87348],
		dec: [-52.70703,-52.7076,-52.70793,-52.70799,-52.7078,-52.70753,-52.7073,-52.70713,-52.70708,-52.70731,-52.70784],
	}, {
		name: "Sirius",
		regex: /^sirius$/i,
		sha: [258.54641,258.53667,258.52689,258.51705,258.50687,258.49623,258.48517,258.47381,258.462,258.44987,258.4376],
		dec: [-16.74044,-16.74182,-16.74295,-16.74383,-16.74448,-16.74508,-16.74573,-16.74645,-16.74732,-16.74847,-16.74993],
	}, {
		name: "Adhara",
		regex: /^adhara$/i,
		sha: [255.19476,255.18605,255.17732,255.16856,255.15953,255.1501,255.1403,255.13023,255.11976,255.10898,255.09806],
		dec: [-28.99601,-28.99732,-28.9984,-28.99923,-28.99984,-29.00042,-29.00106,-29.00178,-29.00266,-29.00382,-29.0053],
	}, {
		name: "Procyon",
		regex: /^procyon$/i,
		sha: [244.97723,244.96568,244.95406,244.94233,244.93017,244.91745,244.90423,244.89066,244.87658,244.86213,244.84756],
		dec: [5.18284,5.18042,5.17821,5.17623,5.17442,5.17259,5.17067,5.16865,5.16644,5.16393,5.16112],
	}, {
		name: "Pollux",
		regex: /^pollux$/i,
		sha: [243.44118,243.4277,243.41408,243.40029,243.38595,243.37093,243.35534,243.33935,243.32278,243.30583,243.28881],
		dec: [27.98621,27.98395,27.98189,27.98006,27.97839,27.9767,27.9749,27.97301,27.97092,27.96853,27.96584],
	}, {
		name: "Avior",
		regex: /^avior$/i,
		sha: [234.29173,234.28716,234.2828,234.27869,234.27468,234.27055,234.26622,234.26171,234.25691,234.2517,234.24614],
		dec: [-59.56054,-59.56346,-59.56619,-59.56872,-59.57114,-59.57361,-59.57622,-59.57894,-59.58187,-59.58511,-59.58862],
	}, {
		name: "Suhail",
		regex: /^suhail$/i,
		sha: [222.86012,222.85193,222.84386,222.83592,222.82787,222.81951,222.81079,222.80179,222.79237,222.7825,222.77234],
		dec: [-43.49586,-43.49951,-43.50301,-43.50635,-43.50964,-43.51304,-43.51659,-43.52029,-43.5242,-43.52842,-43.53288],
	}, {
		name: "Miaplacidus",
		regex: /^miaplacidus$/i,
		sha: [221.65464,221.65221,221.65027,221.64886,221.64792,221.64706,221.64608,221.64494,221.6435,221.64144,221.63875],
		dec: [-69.78129,-69.78498,-69.78852,-69.79192,-69.79526,-69.79872,-69.80234,-69.80609,-69.81008,-69.81435,-69.81887],
	}, {
		name: "Alphard",
		regex: /^alphard$/i,
		sha: [217.91738,217.9065,217.89558,217.88461,217.87329,217.86146,217.84917,217.83654,217.82343,217.80993,217.79628],
		dec: [-8.72631,-8.73022,-8.73401,-8.73766,-8.74128,-8.74502,-8.74894,-8.753,-8.7573,-8.76188,-8.76669],
	}, {
		name: "Regulus",
		regex: /^regulus$/i,
		sha: [207.70689,207.69514,207.68328,207.67127,207.65879,207.64573,207.63218,207.61828,207.60387,207.58913,207.57433],
		dec: [11.89166,11.88727,11.88297,11.87876,11.87452,11.87012,11.86553,11.86079,11.85581,11.85057,11.84514],
	}, {
		name: "Dubhe",
		regex: /^dubhe$/i,
		sha: [193.84294,193.82959,193.81572,193.80124,193.7858,193.76955,193.75274,193.73561,193.71807,193.70056,193.68345],
		dec: [61.6687,61.66389,61.65911,61.65436,61.6495,61.64444,61.63917,61.63375,61.62809,61.62222,61.61622],
	}, {
		name: "Denebola",
		regex: /^denebola$/i,
		sha: [182.54348,182.53224,182.52086,182.50933,182.49732,182.48474,182.47168,182.45829,182.44443,182.43026,182.41605],
		dec: [14.48751,14.48255,14.47758,14.47257,14.46741,14.46201,14.4564,14.45065,14.44467,14.43852,14.43231],
	}, {
		name: "Gienah",
		regex: /^gienah$/i,
		sha: [175.85301,175.84158,175.83016,175.81874,175.80699,175.79473,175.78198,175.76888,175.75523,175.74114,175.72682],
		dec: [-17.62547,-17.63038,-17.63533,-17.64035,-17.64555,-17.651,-17.65665,-17.66245,-17.66846,-17.67461,-17.68079],
	}, {
		name: "Acrux",
		regex: /^acrux$/i,
		sha: [173.1326,173.12,173.10782,173.09607,173.0844,173.07233,173.0597,173.04661,173.03278,173.01802,173.00253],
		dec: [-63.18229,-63.18718,-63.19213,-63.19715,-63.20238,-63.20785,-63.21353,-63.21935,-63.22537,-63.23152,-63.23769],
	}, {
		name: "Gacrux",
		regex: /^gacrux$/i,
		sha: [171.99289,171.98038,171.96818,171.95629,171.94438,171.93203,171.91913,171.90579,171.89175,171.87691,171.86146],
		dec: [-57.19718,-57.20213,-57.20714,-57.21223,-57.21753,-57.22307,-57.22882,-57.23471,-57.2408,-57.24701,-57.25323],
	}, {
		name: "Alioth",
		regex: /^alioth$/i,
		sha: [166.33143,166.32183,166.31182,166.30134,166.29013,166.27832,166.26612,166.2537,166.24099,166.22835,166.21604],
		dec: [55.87873,55.87395,55.86908,55.86411,55.85891,55.85345,55.8478,55.84201,55.83604,55.82997,55.82393],
	}, {
		name: "Spica",
		regex: /^spica$/i,
		sha: [158.50195,158.49025,158.47852,158.46675,158.45462,158.44194,158.42877,158.41524,158.40117,158.38668,158.372],
		dec: [-11.23873,-11.2433,-11.24799,-11.25282,-11.25791,-11.26326,-11.26879,-11.27445,-11.28027,-11.28614,-11.29195],
	}, {
		name: "Alkaid",
		regex: /^alkaid$/i,
		sha: [152.96918,152.96055,152.9516,152.9423,152.93242,152.92201,152.91125,152.90027,152.88901,152.87773,152.86668],
		dec: [49.2395,49.23513,49.23062,49.22595,49.22101,49.21581,49.21043,49.20494,49.19929,49.19363,49.18806],
	}, {
		name: "Hadar",
		regex: /^hadar$/i,
		sha: [148.77059,148.75467,148.73904,148.72368,148.70816,148.69204,148.67522,148.65786,148.63966,148.62053,148.60078],
		dec: [-60.44373,-60.44793,-60.45227,-60.45679,-60.4616,-60.46667,-60.4719,-60.47723,-60.48271,-60.48817,-60.49353],
	}, {
		name: "Menkent",
		regex: /^menkent$/i,
		sha: [148.10433,148.0912,148.07816,148.06518,148.05189,148.03803,148.0236,148.00875,147.99325,147.97715,147.96072],
		dec: [-36.44215,-36.44645,-36.4509,-36.45554,-36.46046,-36.46563,-36.47098,-36.47643,-36.482,-36.48758,-36.49303],
	}, {
		name: "Arcturus",
		regex: /^arcturus$/i,
		sha: [145.91315,145.9031,145.89292,145.88257,145.87178,145.86046,145.84871,145.83666,145.82418,145.81144,145.79867],
		dec: [19.10589,19.10128,19.09651,19.09155,19.0863,19.0808,19.07513,19.06937,19.06348,19.05761,19.05186],
	}, {
		name: "Rigil Kentaurus",
		regex: /^rig[ie]l\s+kent(\.|aurus)?$/i,
		sha: [139.83504,139.82001,139.80522,139.79066,139.77586,139.76038,139.74417,139.72738,139.7097,139.69111,139.67192],
		dec: [-60.89457,-60.89817,-60.90195,-60.90593,-60.91023,-60.91476,-60.91945,-60.92422,-60.92909,-60.93392,-60.93859],
	}, {
		name: "Kochab",
		regex: /^koch?ab$/i,
		sha: [137.33782,137.33838,137.33829,137.3375,137.33602,137.33429,137.33261,137.33105,137.32975,137.32913,137.32928],
		dec: [74.09556,74.09198,74.0882,74.08421,74.07992,74.07538,74.07069,74.06593,74.06107,74.05627,74.05164],
	}, {
		name: "Zuben'ubi",
		regex: /^zuben('?\s*)(elgen)?ubi$/i,
		sha: [137.07037,137.05808,137.04576,137.0334,137.02067,137.00736,136.99353,136.97933,136.96455,136.94933,136.93391],
		dec: [-16.1019,-16.10549,-16.10927,-16.11326,-16.11757,-16.12211,-16.1268,-16.13157,-16.13643,-16.14122,-16.14585],
	}, {
		name: "Alphecca",
		regex: /^alphecca$/i,
		sha: [126.16892,126.15955,126.15005,126.1404,126.13034,126.1198,126.10887,126.09767,126.08609,126.07428,126.06246],
		dec: [26.66677,26.66388,26.66077,26.65742,26.65375,26.64986,26.64586,26.64181,26.63771,26.63373,26.62996],
	}, {
		name: "Antares",
		regex: /^antares$/i,
		sha: [112.41559,112.40197,112.38832,112.3746,112.36046,112.34568,112.33033,112.31456,112.29817,112.28129,112.2642],
		dec: [-26.46185,-26.46368,-26.46576,-26.4681,-26.47075,-26.47359,-26.47649,-26.47941,-26.48232,-26.48505,-26.48751],
	}, {
		name: "Atria",
		regex: /^atria$/i,
		sha: [107.42899,107.4053,107.38166,107.35805,107.3338,107.3085,107.28219,107.25513,107.22695,107.1978,107.16815],
		dec: [-69.05077,-69.05221,-69.05388,-69.05583,-69.05808,-69.0605,-69.06297,-69.06543,-69.06787,-69.0701,-69.07205],
	}, {
		name: "Sabik",
		regex: /^sabik$/i,
		sha: [102.18858,102.17586,102.16308,102.15022,102.13692,102.12302,102.10858,102.09376,102.07837,102.06256,102.04659],
		dec: [-15.73981,-15.74077,-15.74197,-15.74346,-15.74524,-15.74716,-15.74912,-15.75107,-15.75296,-15.75463,-15.75602],
	}, {
		name: "Shaula",
		regex: /^shaula$/i,
		sha: [96.34107,96.32601,96.31089,96.29567,96.27994,96.2635,96.24642,96.22889,96.21068,96.19197,96.17306],
		dec: [-37.11078,-37.11127,-37.11202,-37.11304,-37.11435,-37.11578,-37.11722,-37.11863,-37.11997,-37.12106,-37.12185],
	}, {
		name: "Rasalhague",
		regex: /^rasalhague$/i,
		sha: [96.09115,96.08086,96.07051,96.06007,96.04927,96.03796,96.02623,96.01419,96.0017,95.98888,95.97596],
		dec: [12.55269,12.55216,12.55138,12.55033,12.54899,12.54753,12.54605,12.54461,12.54324,12.54212,12.54129],
	}, {
		name: "Eltanin",
		regex: /^eltanin$/i,
		sha: [90.76073,90.75559,90.75041,90.74518,90.73977,90.73411,90.72823,90.72219,90.71593,90.70951,90.70304],
		dec: [51.49027,51.49025,51.48999,51.48945,51.48864,51.48772,51.48682,51.48596,51.48519,51.48469,51.48449],
	}, {
		name: "Kaus Australis",
		regex: /^kaus\s+aust(\.|ralis)?$/i,
		sha: [83.70682,83.69214,83.67736,83.66243,83.64697,83.6308,83.61401,83.59677,83.5789,83.56058,83.54212],
		dec: [-34.37347,-34.3729,-34.37258,-34.37253,-34.37273,-34.37299,-34.37322,-34.37339,-34.37344,-34.37321,-34.37267],
	}, {
		name: "Vega",
		regex: /^vega$/i,
		sha: [80.63708,80.62957,80.62205,80.6145,80.60672,80.5986,80.59017,80.58151,80.5725,80.56322,80.55383],
		dec: [38.80106,38.80199,38.80269,38.80312,38.80332,38.80346,38.80364,38.80389,38.80428,38.80495,38.80592],
	}, {
		name: "Nunki",
		regex: /^nunki$/i,
		sha: [75.95019,75.93649,75.92267,75.90872,75.89424,75.8791,75.86339,75.84726,75.83055,75.81342,75.79618],
		dec: [-26.27413,-26.2729,-26.27189,-26.27114,-26.27061,-26.27012,-26.26956,-26.26893,-26.26814,-26.26706,-26.26568],
	}, {
		name: "Altair",
		regex: /^altair$/i,
		sha: [62.11994,62.10912,62.09826,62.08733,62.07605,62.06426,62.05202,62.03946,62.02643,62.01303,61.99949],
		dec: [8.91142,8.91389,8.91614,8.91818,8.92006,8.92196,8.92397,8.92609,8.92839,8.93101,8.93391],
	}, {
		name: "Peacock",
		regex: /^peacock$/i,
		sha: [53.29423,53.27692,53.25929,53.24126,53.22238,53.20258,53.18207,53.16107,53.1394,53.11741,53.09552],
		dec: [-56.68326,-56.68029,-56.67751,-56.67492,-56.67243,-56.66989,-56.66721,-56.6644,-56.66139,-56.65807,-56.65447],
	}, {
		name: "Deneb",
		regex: /^deneb$/i,
		sha: [49.51152,49.50393,49.49646,49.48911,49.48167,49.47393,49.46587,49.45755,49.44884,49.43971,49.43029],
		dec: [45.33685,45.3401,45.34317,45.34606,45.34886,45.35174,45.35476,45.35792,45.36128,45.36496,45.36889],
	}, {
		name: "Enif",
		regex: /^enif$/i,
		sha: [33.76776,33.75687,33.74597,33.73501,33.72371,33.7119,33.69964,33.68704,33.67395,33.66047,33.64683],
		dec: [9.94627,9.9504,9.95442,9.95832,9.96221,9.96624,9.97046,9.97482,9.97942,9.98429,9.98938],
	}, {
		name: "Al Na'ir",
		regex: /^al\s*na'?ir$/i,
		sha: [27.7081,27.6943,27.6802,27.66572,27.65051,27.63454,27.618,27.6011,27.58367,27.56606,27.54858],
		dec: [-46.88604,-46.88169,-46.87743,-46.87326,-46.86906,-46.8647,-46.86015,-46.85544,-46.8505,-46.8453,-46.8399],
	}, {
		name: "Fomalhaut",
		regex: /^fomalhaut$/i,
		sha: [15.38106,15.3689,15.35653,15.34392,15.33073,15.31691,15.30259,15.28793,15.2728,15.25742,15.24207],
		dec: [-29.54124,-29.53651,-29.53183,-29.52718,-29.52243,-29.51748,-29.51233,-29.50702,-29.50148,-29.49571,-29.48981],
	}, {
		name: "Scheat",
		regex: /^scheat$/i,
		sha: [13.87159,13.86078,13.85005,13.83937,13.82845,13.81708,13.80524,13.79306,13.78035,13.76717,13.7537],
		dec: [28.16555,28.17039,28.17519,28.17997,28.18486,28.18995,28.19524,28.20069,28.20637,28.21227,28.2183],
	}, {
		name: "Markab",
		regex: /^markab$/i,
		sha: [13.62082,13.60976,13.59871,13.58763,13.57624,13.56434,13.55198,13.53927,13.52605,13.51241,13.49857],
		dec: [15.28735,15.29214,15.2969,15.30164,15.30648,15.31153,15.31679,15.32219,15.32784,15.33369,15.33968],
	}],
	getStar: function(name, unixtime) {
		const { timeList, stars } = this;
		const star = stars.find(star => star.regex.test(name));
		if (!star) {
			return null;
		}
		let a = 0;
		let b = timeList.length - 1;
		if (unixtime < timeList[a] || unixtime > timeList[b]) {
			return null;
		}
		while (b - a > 1) {
			const m = (b + a) >> 1;
			const t = timeList[m];
			if (unixtime > t) {
				a = m;
			} else {
				b = m;
			}
		}
		const range = timeList[b] - timeList[a];
		const offset = unixtime - timeList[a];
		const val = offset/range;
		const shaDecA = [ star.sha[a], star.dec[a] ];
		const shaDecB = [ star.sha[b], star.dec[b] ];
		const latLonA = shaDecToLatLon(shaDecA);
		const latLonB = shaDecToLatLon(shaDecB);
		const latlon = interpolate(latLonA, latLonB, val);
		const [ sha, dec ] = latLonToShaDec(latlon);
		return { sha, dec };
	},
};
export default Almanac;
